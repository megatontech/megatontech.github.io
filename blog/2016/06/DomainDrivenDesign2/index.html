<!DOCTYPE html>
<html lang="en" class="no-js single-page-layout" data-classic-layout="false" data-mobile-only-classic-layout="true" data-inanimation="fadeInUp"
      data-outanimation="fadeOutDownBig">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="The personal website,blog of yuri yu: programmer, web developer.
">
    <meta name="keywords" content="MEGATONTECH, web dev, web developer, YURI , YU,techme">
    <meta name="author" content="Yuri yu">
    <meta name="google-site-verification" content="J1I2enqCVWPWxLX82JE84giuntMY1SztQxGovPSBLc4">
    <title>Yuri yu- Home</title>
    <!-- FAV and TOUCH ICONS -->
    <link rel="shortcut icon" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
    <script src="/js/modernizr.custom.js"></script>
    <!-- STYLES -->
    <link rel="stylesheet" media="print" href="/css/print.css">
    <link rel="stylesheet" href="/css/normalize.css">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/js/nprogress/nprogress.css">
    <link rel="stylesheet" href="/css/animate.css">
    <link rel="stylesheet" href="/css/fonts/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/fonts/fontello/css/fontello.css">
    <link rel="stylesheet" href="/css/jquery.fancybox-1.3.4.css">
    <link rel="stylesheet" href="/js/google-code-prettify/prettify.css">
    <link rel="stylesheet" href="/css/uniform.default.css">
    <link rel="stylesheet" href="/css/flexslider.css">
    <link rel="stylesheet" href="/js/mediaelement/mediaelementplayer.css">
    <link rel="stylesheet" href="/css/tooltipster.css">
    <link rel="stylesheet" href="/css/rr_light.css">
    <link rel="stylesheet" href="/js/tipuesearch/tipuesearch.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/personal.css">
    <link rel="stylesheet" href="/css/fonts.googleapis.com.css">
    <!--[if lte IE 9]>
    <script src="/js/html5shiv.js"></script>
    <script src="/js/respond.min.js"></script>
    <script src="/js/selectivizr-min.js"></script>
    <![endif]-->
</head>

<body>
    <!-- CONTAINER -->
    <div class="container" id="container">
        <!-- HEADER -->
        <header class="header">
            <h1>yuri yu</h1>
            <p>geek, programmer, web developer, acfuner</p>
            <!-- NAV MENU -->
            <ul class="vs-nav">
                <li><a href="/"><i title="go to home" class="icon-home-1 tooltip" data-tooltip-pos="bottom"></i></a></li>
                <li><a><i title="search" class="search-link fa fa-search tooltip" data-tooltip-pos="right"></i></a></li>
            </ul>
            <!-- NAV MENU -->
            <!-- SEARCH -->
            <div class="header-search">
                <form role="search" method="get" id="search-form" action="/search">
                    <input type="text" name="q" id="search" placeholder="ENTER KEYWORD" required>
                    <input type="submit" id="search-submit" title="Search" value="→">
                </form>
            </div>
            <!-- SEARCH -->
        </header>
        <!-- HEADER -->
        <!-- WRAPPER -->
        <div class="wrapper">
            <!-- .blog-single -->
            <div class="readable-content blog-single">
                <!-- .hentry -->
                <article class="post type-post format-standard hentry">
                    <!-- .entry-header -->
                    <header class="entry-header">
                        <h1 class="entry-title">Restful 软件架构风格</h1>
                    </header>
                    <!-- .entry-header -->
                    <!-- .entry-meta -->
                    <div class="entry-meta">
                        <span class="posted-in">
                        </span>
                        <span class="posted-on">
                            on
                            <a rel="bookmark"><time class="entry-date">jun 24, 2016</time></a>
                        </span>

                        <span class="posted-by">
                            by
                            <a href="/blog" class="url fn n" title="View all posts by this author" rel="author">Yuri yu</a>
                        </span>
                    </div>
                    <!-- .entry-meta -->
                    <!-- .featured-image -->
                    <div class="featured-image">
                        <img src="/img/posts/Restful.jpg" alt="A screenshot of the Restful" title="EDI">
                    </div>
                    <!-- .featured-image -->
                    <!-- .entry-content -->
                    <div class="entry-content">
                        <p>本文内容很简单，只阐述下面几个问题——一切美好的东西都应该是简单的</p>
                         
                        <div id="LeftContent">
                            <div class="navpage" xmlns="http://www.w3.org/1999/xhtml">
                                <div class="mag">
                                    <div class="allWidth issueHeader" id="">
                                        <hr>
                                        <div class="issueDate">September 2013</div>
                                        <div class="issueNum">Volume 28 Number 9</div>
                                    </div>
                                    <div class="article">
                                        <div class="FeatureTitle" id="">
                                            <h1>Data Points - Coding for Domain-Driven Design: Tips for Data-Focused Devs, Part 2</h1>
                                            <p>By <a href="https://msdn.microsoft.com/en-us/magazine/mt149362?author=julie+lerman">Julie Lerman</a> | September 2013 | Get the Code: <a href="http://download.microsoft.com/download/7/C/9/7C994C6D-5ADA-4FC2-AC9C-F0DD492FFA0B/Code_LermanDataPoints0913.zip">C#</a>&nbsp;&nbsp;&nbsp;<a href="http://download.microsoft.com/download/7/C/9/7C994C6D-5ADA-4FC2-AC9C-F0DD492FFA0B/VBCode_LermanDataPoints0913.zip">VB</a></p>
                                            <p>
                                                <strong>Read the entire Domain-Driven Design series:</strong>
                                                <br>Coding for Domain-Driven Design: Tips for Data-Focused Devs, <a href="https://msdn.microsoft.com/magazine/dn342868.aspx">Part 1</a><br>Coding for Domain-Driven Design: Tips for Data-Focused Devs, <a href="https://msdn.microsoft.com/magazine/dn385704.aspx">Part 2</a><br>Coding for Domain-Driven Design: Tips for Data-Focused Devs, <a href="https://msdn.microsoft.com/magazine/dn451438.aspx">Part 3</a>
                                            </p>
                                        </div>
                                        <p>
                                            <img alt="Julie Lerman" height="150" src="https://i-msdn.sec.s-msft.com/dynimg/IC455744.jpg" style="float:left;margin:0 2em 1.5em 0;" width="100">This month’s column will continue celebrating the 10th anniversary of Eric Evans’ book, “Domain-Driven Design: Tackling Complexity in the Heart of Software” (Addison-Wesley Professional, 2003). I’ll share more tips for data-first developers who are interested in benefiting from some of the coding patterns of Domain-Driven Design (DDD). Last month’s column highlighted:
                                        </p>
                                        <ul>
                                            <li>Setting persistence concerns aside when modeling the domain</li>
                                            <li>Exposing methods to drive your entities and aggregates, but not your property setters</li>
                                            <li>Recognizing that some subsystems are perfect for simple create, read, update and delete (CRUD) interaction and don’t require domain modeling</li>
                                            <li>The benefit of not attempting to share data or types across bounded contexts</li>
                                        </ul>
                                        <p>In this column you’ll learn what’s meant by the terms “anemic” and “rich” domain models, as well as the concept of value objects. Value objects seem to be a topic that falls into one of two camps for developers. It’s either so obvious that some readers can’t imagine why it warrants any discussion at all, or so baffling that others have never been able to wrap their heads around it. I’ll also encourage you to consider using value objects in place of related objects in certain scenarios.</p>
                                        <div>
                                            <h2>That Condescending Term: Anemic Domain Models</h2>
                                            <p>There’s a pair of terms you’ll often hear with respect to how classes are defined in DDD—anemic domain model and rich domain model. In DDD, domain model refers to a class. A rich domain model is one that aligns with the DDD approach—a class (or type) that’s defined with behaviors, not just with getters and setters. In contrast, an anemic domain model consists simply of getters and setters (and maybe a few simple methods), which is fine for many scenarios, but gains no benefit from DDD.</p>
                                            <p>When I started using Entity Framework (EF) Code First, the classes I intended Code First to work with were probably 99 percent anemic. <strong>Figure 1</strong> is a perfect example, showing a Customer type and the Person type from which it inherits. I’d often include a handful of methods, but the basic type was merely a schema with getters and setters.</p>
                                            <div class="codeCaption">Figure 1 Typical Anemic Domain Model Classes Look Like Database Tables</div>
                                            <div id="code-snippet-1" class="codeSnippetContainer" xmlns="">
                                                <div class="codeSnippetContainerTabs">
                                                    <div class="codeSnippetContainerTabSingle" dir="ltr"><a>XML</a></div>
                                                </div>
                                                <div class="codeSnippetContainerCodeContainer">
                                                    <div class="codeSnippetToolBar">
                                                        <div class="codeSnippetToolBarText">
                                                            <a name="CodeSnippetCopyLink" style="display: none;" title="Copy to clipboard." href="javascript:if (window.epx.codeSnippet)window.epx.codeSnippet.copyCode('CodeSnippetContainerCode_7585bd2c-ffa1-4c24-a2ad-e101be06020c');" ms.cmptyp="CodeSnippet">Copy</a>
                                                        </div>
                                                    </div>
                                                    <div id="CodeSnippetContainerCode_7585bd2c-ffa1-4c24-a2ad-e101be06020c" class="codeSnippetContainerCode" dir="ltr">
                                                        <div style="color:Black;">
                                                            <pre>public class Customer : Person
{
&nbsp; public Customer()
&nbsp; {
&nbsp;&nbsp;&nbsp; Orders = new List<span style="color:Blue;">&lt;</span><span style="color:#A31515;">Order</span><span style="color:Blue;">&gt;</span>();
&nbsp; }
&nbsp; public ICollection<span style="color:Blue;">&lt;</span><span style="color:#A31515;">Order</span><span style="color:Blue;">&gt;</span> Orders { get; set; }
&nbsp; public string SalesPersonId { get; set; }
&nbsp; public ShippingAddress ShippingAddress { get; set; }
}
public abstract class Person
{
&nbsp; public int Id { get; set; }
&nbsp; public string Title { get; set; }
&nbsp; public string FirstName { get; set; }
&nbsp; public string LastName { get; set; }
&nbsp; public string CompanyName { get; set; }
&nbsp; public string EmailAddress { get; set; }
&nbsp; public string Phone { get; set; }
}
</pre>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                            <p>I finally looked at these classes and realized I was doing little more than defining a database table in my class. It’s not necessarily a bad thing, depending on what you plan to do with the type.</p><p>Compare that to the richer Customer type listed in <strong>Figure 2</strong>, which is similar to the Customer type I explored in my previous column (<a href="https://msdn.microsoft.com/magazine/dn342868">msdn.microsoft.com/magazine/dn342868</a>). It exposes methods that control access to properties and other types that are part of the aggregate. I’ve tweaked the Customer type since you saw it in the earlier column to better express some of the topics I’m discussing this month.</p><div class="codeCaption">Figure 2 A Customer Type That’s a Rich Domain Model, Not Simply Properties</div>
                                            <div id="code-snippet-2" class="codeSnippetContainer" xmlns="">
                                                <div class="codeSnippetContainerTabs">
                                                    <div class="codeSnippetContainerTabSingle" dir="ltr"><a>XML</a></div>
                                                </div>
                                                <div class="codeSnippetContainerCodeContainer">
                                                    <div class="codeSnippetToolBar">
                                                        <div class="codeSnippetToolBarText">
                                                            <a name="CodeSnippetCopyLink" style="display: none;" title="Copy to clipboard." href="javascript:if (window.epx.codeSnippet)window.epx.codeSnippet.copyCode('CodeSnippetContainerCode_8320a9d7-6521-4cee-81f3-7c11fa8338cc');" ms.cmptyp="CodeSnippet">Copy</a>
                                                        </div>
                                                    </div>
                                                    <div id="CodeSnippetContainerCode_8320a9d7-6521-4cee-81f3-7c11fa8338cc" class="codeSnippetContainerCode" dir="ltr">
                                                        <div style="color:Black;">
                                                            <pre>public class Customer : Contact
{
&nbsp; public Customer(string firstName, string lastName, string email)
&nbsp; {
&nbsp;&nbsp;&nbsp; FullName = new FullName(firstName, lastName);
&nbsp;&nbsp;&nbsp; EmailAddress = email;
&nbsp;&nbsp;&nbsp; Status = CustomerStatus.Silver;
&nbsp; }
&nbsp; internal Customer()
&nbsp; {
&nbsp; }
&nbsp; public void UseBillingAddressForShippingAddress()
&nbsp; {
&nbsp;&nbsp;&nbsp; ShippingAddress = new Address(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BillingAddress.Street1, BillingAddress.Street2,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BillingAddress.City, BillingAddress.Region,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BillingAddress.Country, BillingAddress.PostalCode);
&nbsp; }
&nbsp; public void CreateNewShippingAddress(string street1, string street2,
&nbsp;&nbsp; string city, string region, string country, string postalCode)
&nbsp; {
&nbsp;&nbsp;&nbsp; BillingAddress = new Address(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; street1,street2,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; city,region,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; country,postalCode)
&nbsp; }
&nbsp; public void CreateBillingInformation(string street1,string street2,
&nbsp;&nbsp; string city,string region,string country, string postalCode,
&nbsp;&nbsp; string creditcardNumber, string bankName)
&nbsp; {
&nbsp;&nbsp;&nbsp; BillingAddress = new Address&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (street1,street2, city,region,country,postalCode );
&nbsp;&nbsp;&nbsp; CreditCard = new CustomerCreditCard (bankName, creditcardNumber );
&nbsp; }
&nbsp; public void SetCustomerContactDetails
&nbsp;&nbsp; (string email, string phone, string companyName)
&nbsp; {
&nbsp;&nbsp;&nbsp; EmailAddress = email;
&nbsp;&nbsp;&nbsp; Phone = phone;
&nbsp;&nbsp;&nbsp; CompanyName = companyName;
&nbsp; }
&nbsp; public string SalesPersonId { get; private set; }
&nbsp; public CustomerStatus Status { get; private set; }
&nbsp; public Address ShippingAddress { get; private set; }
&nbsp; public Address BillingAddress { get; private set; }
&nbsp; public CustomerCreditCard CreditCard { get; private set; }
}
</pre>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                            <p>In this richer model, rather than simply exposing properties to be read and written to, the public surface of Customer is made up of explicit methods. Review the Private Setters and Public Methods section of last month’s column for more details. My point here is to help you better comprehend the difference between what DDD refers to as an anemic versus a rich domain model.</p>
                                        </div>
                                        <div>
                                            <h2>Value Objects Can Be Confusing</h2>
                                            <p>Though they seem simple, DDD value objects are a serious point of confusion for many, including me. I’ve read and heard so many different ways of describing value objects from a variety of perspectives. Luckily, each of the different explanations, rather than conflicting with one another, helped me build a deeper understanding of value objects.</p>
                                            <p>At its core, a value object is a class that doesn’t have an identity key.</p>
                                            <p>Entity Framework has a concept of “complex types” that comes fairly close. Complex types don’t have an identity key—they’re a way of encapsulating a set of properties. EF understands how to handle these objects when it comes to data persistence. In the database, they get stored as fields of the table to which the entity is mapped.</p>
                                            <p>For example, instead of having a FirstName property and a LastName property in your Person class, you could have a FullName property:</p>
                                            <div id="code-snippet-3" class="codeSnippetContainer" xmlns="">
                                                <div class="codeSnippetContainerTabs">
                                                    <div class="codeSnippetContainerTabSingle" dir="ltr"><a>XML</a></div>
                                                </div>
                                                <div class="codeSnippetContainerCodeContainer">
                                                    <div class="codeSnippetToolBar">
                                                        <div class="codeSnippetToolBarText">
                                                            <a name="CodeSnippetCopyLink" style="display: none;" title="Copy to clipboard." href="javascript:if (window.epx.codeSnippet)window.epx.codeSnippet.copyCode('CodeSnippetContainerCode_9d688a4c-e486-42d8-8699-1b225050eadb');" ms.cmptyp="CodeSnippet">Copy</a>
                                                        </div>
                                                    </div>
                                                    <div id="CodeSnippetContainerCode_9d688a4c-e486-42d8-8699-1b225050eadb" class="codeSnippetContainerCode" dir="ltr">
                                                        <div style="color:Black;">
                                                            <pre>public FullName FullName { get; set; }
</pre>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                            <p>FullName can be a class that encapsulates the FirstName and LastName properties, with a constructor that forces you to provide both of those properties.</p><p>But a value object is more than a complex type. In DDD, there are three defining characteristics of a value object:</p><ol><li>It has no identity key (this aligns with a complex type)</li><li>It’s immutable</li><li>When checking its equality to other instances of the same type, all of its values are compared</li></ol><p>Immutability is interesting. Without an identity key, a type’s immutability defines its identity. You can always identify an instance by the combination of its properties. Because it’s immutable, none of the type’s properties can change, so it’s safe to use the type’s values to identify a particular instance. (You’ve already seen how DDD entities protect themselves from random modifications by making their setters private, but you could have a method that allows you to affect those properties.) Not only does a value object hide the setters, but it prevents you from modifying any of the properties. If you modified a property, that would mean the value of the object has changed. Because the entire object represents its value, you don’t interact with its properties individually. If you need the object to have different values, you create a new instance of the object to hold a new set of values. In the end, there’s no such thing as changing a property of a value object—which effectively makes even formulating a sentence that includes the phrase “if you need to change a value of a property” an oxymoron. A useful parallel is to consider a string, which is another immutable type (at least in all languages with which I’m familiar). When working with a string instance, you don’t replace individual characters of the string. You simply create a new string.</p><p>My FullName value object is shown in <strong>Figure 3</strong>. It has no identity key property. You can see that the only way to instantiate it is by providing both property values, and there’s no way to modify either of those properties. So it fulfills the immutability requirement. The final requirement, that it provides a way to compare equality to another instance of that type, is hidden in the custom ValueObject class (that I’ve borrowed from Jimmy Bogard at <a href="http://bit.ly/13SWd9h">bit.ly/13SWd9h</a>) from which it inherits, because that’s a bunch of convoluted code. Although this ValueObject doesn’t account for collection properties, it meets my needs because I don’t have any collections within this value object.</p><div class="codeCaption">Figure 3 The FullName Value Object</div>
                                            <div id="code-snippet-4" class="codeSnippetContainer" xmlns="">
                                                <div class="codeSnippetContainerTabs">
                                                    <div class="codeSnippetContainerTabSingle" dir="ltr"><a>XML</a></div>
                                                </div>
                                                <div class="codeSnippetContainerCodeContainer">
                                                    <div class="codeSnippetToolBar">
                                                        <div class="codeSnippetToolBarText">
                                                            <a name="CodeSnippetCopyLink" style="display: none;" title="Copy to clipboard." href="javascript:if (window.epx.codeSnippet)window.epx.codeSnippet.copyCode('CodeSnippetContainerCode_65bf9ec7-7cda-482b-9706-36cd3ca3735e');" ms.cmptyp="CodeSnippet">Copy</a>
                                                        </div>
                                                    </div>
                                                    <div id="CodeSnippetContainerCode_65bf9ec7-7cda-482b-9706-36cd3ca3735e" class="codeSnippetContainerCode" dir="ltr">
                                                        <div style="color:Black;">
                                                            <pre>public class FullName:ValueObject<span style="color:Blue;">&lt;</span><span style="color:#A31515;">FullName</span><span style="color:Blue;">&gt;</span>
{
&nbsp; public FullName(string firstName, string lastName)
&nbsp; {
&nbsp;&nbsp;&nbsp; FirstName = firstName;
&nbsp;&nbsp;&nbsp; LastName = lastName;
&nbsp; }
&nbsp; public FullName(FullName fullName)
&nbsp;&nbsp;&nbsp; : this(fullName.FirstName, fullName.LastName)
&nbsp; {&nbsp;&nbsp;&nbsp; }
&nbsp; internal FullName() { }
&nbsp; public string FirstName { get; private set; }
&nbsp; public string LastName { get; private set; }
&nbsp;// More methods, properties for display formatting
}
</pre>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                            <p>Keeping in mind that you may want a modified copy—for example, similar to this FullName but with a different FirstName—Vaughn Vernon, author of “Implementing Domain-Driven Design” (Addison-Wesley Professional, 2013), suggests FullName could include methods to create new instances from the existing instance:</p>
                                            <div id="code-snippet-5" class="codeSnippetContainer" xmlns="">
                                                <div class="codeSnippetContainerTabs">
                                                    <div class="codeSnippetContainerTabSingle" dir="ltr"><a>XML</a></div>
                                                </div>
                                                <div class="codeSnippetContainerCodeContainer">
                                                    <div class="codeSnippetToolBar">
                                                        <div class="codeSnippetToolBarText">
                                                            <a name="CodeSnippetCopyLink" style="display: none;" title="Copy to clipboard." href="javascript:if (window.epx.codeSnippet)window.epx.codeSnippet.copyCode('CodeSnippetContainerCode_f24978d5-6d42-4f42-8f3d-d65712fb9509');" ms.cmptyp="CodeSnippet">Copy</a>
                                                        </div>
                                                    </div>
                                                    <div id="CodeSnippetContainerCode_f24978d5-6d42-4f42-8f3d-d65712fb9509" class="codeSnippetContainerCode" dir="ltr">
                                                        <div style="color:Black;">
                                                            <pre>public FullName WithChangedFirstName(string firstName)
{
&nbsp; return new FullName(firstName, this.LastName);
}
public FullName WithChangedLastName(string lastName)
{
&nbsp; return new FullName(this.FirstName, lastName);
}
</pre>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                            <p>When I add in my persistence layer (Entity Framework), it will see this as an EF ComplexType property of any class in which it’s used. When I use FullName as a property of my Person type, EF will store the properties of FullName in the database table where the Person type is stored. By default, the properties will be named FullName_FirstName and FullName_LastName in the database.</p><p>FullName is pretty straightforward. Even if you were doing database-focused design, you might not want to store FirstName and LastName in a separate table.</p>
                                        </div>
                                        <div>
                                            <h2>Value Objects or Related Objects?</h2>
                                            <p>But now consider another scenario—imagine a Customer with a ShippingAddress and a BillingAddress:</p>
                                            <div id="code-snippet-6" class="codeSnippetContainer" xmlns="">
                                                <div class="codeSnippetContainerTabs">
                                                    <div class="codeSnippetContainerTabSingle" dir="ltr"><a>XML</a></div>
                                                </div>
                                                <div class="codeSnippetContainerCodeContainer">
                                                    <div class="codeSnippetToolBar">
                                                        <div class="codeSnippetToolBarText">
                                                            <a name="CodeSnippetCopyLink" style="display: none;" title="Copy to clipboard." href="javascript:if (window.epx.codeSnippet)window.epx.codeSnippet.copyCode('CodeSnippetContainerCode_09cf33c3-7668-4e1d-8644-81675a23fcee');" ms.cmptyp="CodeSnippet">Copy</a>
                                                        </div>
                                                    </div>
                                                    <div id="CodeSnippetContainerCode_09cf33c3-7668-4e1d-8644-81675a23fcee" class="codeSnippetContainerCode" dir="ltr">
                                                        <div style="color:Black;">
                                                            <pre>public Address ShippingAddress { get; private set; }
public Address BillingAddress { get; private set; }
</pre>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                            <p>By (data-driven brain) default, I create Address as an Entity, including an AddressId property. And, again, because I “think in data,” I presume that Address will be stored as a separate table in the database. OK, I’m working hard to train myself to stop considering the database while modeling my domain, so that’s of no consequence. However, at some point I’ll add in my data layer using EF and EF will also make this assumption. But EF won’t be able to work out the mappings correctly. It will presume a 0..1:* relationship between Address and Customer; in other words, that an address might have any number of related customers and a Customer will have either no addresses or one address.</p><p>My DBA might not like this result and, what’s more important, I won’t be writing my application code based on the same assumption that Entity Framework is making—that there are many Customers to zero or one Address. Because of this, EF might affect my data persistence or retrieval in some unexpected ways. So from the perspective of someone who’s been working with EF quite a lot, my first approach is to fix the EF mappings using the Fluent API. But asking EF to fix this problem would force me to add navigation properties from Address pointing back to Customer, which I don’t want in my model. As you can see, solving this problem with EF mappings would lead me down a rabbit hole.</p><p>When I step back and focus on the domain, not on EF or the database, it makes more sense to simply make Address a value object instead of an entity. Three steps are required:</p><ol><li>I need to remove the key property from the Address type (possibly called Id or AddressId).</li><li>I need to be sure that Address is immutable. Its constructor already lets me populate all of the fields. I have to remove any methods that would allow any properties to change.</li><li>I need to ensure that Address can be checked for equality based on the values of its properties and fields. I can do that by inheriting again from that nice ValueObject class I borrowed from Jimmy Bogard (see <strong>Figure 4</strong>).</li></ol><div class="codeCaption">Figure 4 Address as a Value Object</div>
                                            <div id="code-snippet-7" class="codeSnippetContainer" xmlns="">
                                                <div class="codeSnippetContainerTabs">
                                                    <div class="codeSnippetContainerTabSingle" dir="ltr"><a>XML</a></div>
                                                </div>
                                                <div class="codeSnippetContainerCodeContainer">
                                                    <div class="codeSnippetToolBar">
                                                        <div class="codeSnippetToolBarText">
                                                            <a name="CodeSnippetCopyLink" style="display: none;" title="Copy to clipboard." href="javascript:if (window.epx.codeSnippet)window.epx.codeSnippet.copyCode('CodeSnippetContainerCode_b8d232f4-4cd4-4424-b390-b80fb794ef2c');" ms.cmptyp="CodeSnippet">Copy</a>
                                                        </div>
                                                    </div>
                                                    <div id="CodeSnippetContainerCode_b8d232f4-4cd4-4424-b390-b80fb794ef2c" class="codeSnippetContainerCode" dir="ltr">
                                                        <div style="color:Black;">
                                                            <pre>public class Address:ValueObject<span style="color:Blue;">&lt;</span><span style="color:#A31515;">Address</span><span style="color:Blue;">&gt;</span>
{
&nbsp; public Address(string street1, string street2, 
    string city, string region,
&nbsp;&nbsp;&nbsp; string country, string postalCode) {
&nbsp;&nbsp;&nbsp; Street1 = street1;
&nbsp;&nbsp;&nbsp; Street2 = street2;
&nbsp;&nbsp;&nbsp; City = city;
&nbsp;&nbsp;&nbsp; Region = region;
&nbsp;&nbsp;&nbsp; Country = country;
&nbsp;&nbsp;&nbsp; PostalCode = postalCode;&nbsp; }
&nbsp; internal Address()&nbsp; {&nbsp; }
&nbsp; public string Street1 { get; private set; }
&nbsp; public string Street2 { get; private set; }
&nbsp; public string City { get; private set; }
&nbsp; public string Region { get; private set; }
&nbsp; public string Country { get; private set; }
&nbsp; public string PostalCode { get; private set; }
&nbsp; // ...&nbsp;
}
</pre>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                            <p>How I use this Address class from my Customer class won’t change, except that if I need to modify the address, I’ll have to create a new instance.</p><p>But now I no longer need to worry about managing that relationship. And it also provides another litmus test for value objects, in that a Customer really is defined by its shipping and billing information because if I sell anything to that customer, I’ll most likely need to ship it and the Accounts Payable department requires that I have its billing address.</p><p>This is not to say that every 1:1 or 1:0..1 relationship can be replaced with value objects, but it’s a nice solution here and my job became a lot simpler when I stopped having to solve one puzzle after another that popped up as I tried to force Entity Framework to maintain this relationship for me.</p><p>Like the FullName example, changing Address to be a value object means Entity Framework will see Address as a ComplexType and will store all of that data within the Customer tables. Years of being focused on database normalization made me automatically think this was a bad thing, but my database can handle it easily and it works for my particular domain.</p><p>I can think of many arguments against using this technique, but they all begin with “what if.” Any of those that don’t pertain to my domain aren’t valid arguments. We waste a lot of time coding for just-in-case scenarios that never come to pass. I’m trying to be more considerate about adding those preemptive Band-Aids into my solutions.</p><h2>Not Done Quite Yet</h2><p>I’m really getting through the list of DDD concepts that have haunted this data geek. As I grok more of these concepts, I become inspired to learn even more. Once I shift my thinking a bit, these patterns make a lot of sense for me. They don’t reduce my interest in data persistence one bit, but separating the domain from the data persistence and infra&shy;structure feels right to me after having them tangled up together for so many years. Still, it’s important to keep in mind that there are so many software activities that don’t need DDD. DDD can help sort out complex problems, but quite often it’s overkill for simple ones.</p><p>In the next column I’ll discuss a few other DDD technical strategies that also initially seemed to conflict with my data-first thinking, such as letting go of bidirectional relationships, considering invariants and dealing with any perceived need to trigger data access from your aggregates.</p>
                                        </div>
                                        <hr>
                                        <div>
                                            <div>
                                                <div>
                                                    <div>
                                                        <p>
                                                            <strong>Julie Lerman</strong>&nbsp;<em>is a Microsoft MVP, .NET mentor and consultant who lives in the hills of Vermont. You can find her presenting on data access and other Microsoft .NET topics at user groups and conferences around the world. She blogs at <a href="http://thedatafarm.com/blog">thedatafarm.com/blog</a> and is the author of “Programming Entity Framework” (2010) as well as a Code First edition (2011) and a DbContext edition (2012), all from O’Reilly Media. Follow her on Twitter at <a href="http://twitter.com/julielerman">twitter.com/julielerman</a> and see her Pluralsight courses at <a href="http://juliel.me/PS-Videos">juliel.me/PS-Videos</a>.</em>
                                                        </p>
                                                    </div>
                                                    <div>
                                                        <p>Thanks to the following technical expert for reviewing this article: Stephen Bohlen (Microsoft)<br>Stephen A. Bohlen is currently a Senior Technology Evangelist for Microsoft Corporation, and brings his varied 20-plus-years of experience as a former practicing architect, CAD manager, IT technologist, software engineer, CTO, and consultant to assist select Microsoft partner organizations in their adoption of cutting-edge and pre-release Microsoft developer products and technologies.</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <p>&nbsp;</p>
                                    </div>
                                    <div class="navpage" xmlns="http://www.w3.org/1999/xhtml">
                                        <script type="text/javascript" src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.1.3.min.js" data-do-not-move="true" data-provides="jQuery">&nbsp;</script>

                                        <script type="text/javascript" src="https://ajax.aspnetcdn.com/ajax/bootstrap/3.3.4/bootstrap.min.js" data-do-not-move="true">&nbsp;</script>
                                        <script type="text/javascript" src="https://www.microsoft.com/feeds/msdn/en-us/magazine/main.js" data-do-not-move="true">&nbsp;</script>

                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        
                         
                        <hr />
                        <!-- .related-posts -->
                    </div>
                    <!-- .entry-content -->
                    <!-- .entry-meta -->
                    <footer class="entry-meta">
                        <h3>TAGS</h3>
                        <a href="#" title="">Github</a>
                    </footer>
                    <!-- .entry-meta -->
                </article>
                <!-- .hentry -->
                <!-- .about-author -->
                <aside class="about-author">
                    <h3>WRITTEN BY</h3>
                    <!-- .author-bio -->
                    <div class="author-bio">
                        <!-- .author-img -->
                        <div class="author-img">
                            <a href="/#/about"><img alt="Avatar" src="/img/avatar.png" class="avatar"></a>
                        </div>
                        <!-- .author-img -->
                        <!-- .author-info -->
                        <div class="author-info">
                            <h4 class="author-name">yuri yu</h4>
                            <p>yuri yu is a programmer </p>
                        </div>
                        <!-- .author-info -->
                    </div>
                    <!-- .author-bio -->
                </aside>
                <!-- .about-author -->
                <!-- .nav-single -->
                <nav class="nav-single row">
                    <div class="nav-previous col-sm-6">

                        <h4>PREVIOUS POST</h4>
                        <a href="#" rel="prev"><span class="meta-nav">←</span> There's no more post</a>
                    </div>
                    <div class="nav-next col-sm-6">
                    </div>
                </nav>
                <!-- .nav-single -->
            </div>
            <!-- .blog-single -->
        </div>
        <!-- WRAPPER -->
        <!-- PORTFOLIO SINGLE AJAX CONTENT CONTAINER -->
        <div class="p-overlay"></div>
        <div class="p-overlay"></div>
        <!-- ALERT : used for contact form mail delivery alert -->
        <div class="site-alert animated"></div>
        <!-- SCRIPTS -->
        <script src="/js/jquery-1.10.2.min.js"></script>
        <script src="/js/jquery-migrate-1.2.1.min.js"></script>
        <script src="/js/jquery.address-1.5.min.js"></script>
        <script src="/js/triple.layout.js"></script>
        <script src="/js/smoothscroll.js"></script>
        <script src="/js/nprogress/nprogress.js"></script>
        <script src="/js/fastclick.js"></script>
        <script src="/js/jquery.imagesloaded.min.js"></script>
        <script src="/js/jquery.isotope.min.js"></script>
        <script src="/js/jquery.flexslider-min.js"></script>
        <script src="/js/jquery.fitvids.js"></script>
        <script src="/js/jquery.validate.min.js"></script>
        <script src="/js/jquery.uniform.min.js"></script>
        <script src="/js/jquery.fancybox-1.3.4.pack.js"></script>
        <script src="/js/jquery.tooltipster.min.js"></script>
        <script src="/js/google-code-prettify/prettify.js"></script>
        <script src="/js/twitterFetcher_v10_min.js"></script>
        <script src="/js/mediaelement/mediaelement-and-player.min.js"></script>
        <script src="/js/send-mail.js"></script>
        <script src="/js/classie.js"></script>
        <script src="/js/readmore.min.js"></script>
        <script src="/js/readremaining.jquery.js"></script>
        <script src="/js/personal.js"></script>
        <script src="/js/main.js"></script>
        <script src="/js/blog-post.js"></script>
        <script src="/js/lazyload.js"></script>
        <script>
            $("img").lazyload();
        </script>
    </div>
    <!-- CONTAINER -->
</body>
</html>