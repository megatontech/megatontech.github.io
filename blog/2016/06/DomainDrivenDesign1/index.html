<!DOCTYPE html>
<html lang="en" class="no-js single-page-layout" data-classic-layout="false" data-mobile-only-classic-layout="true" data-inanimation="fadeInUp"
      data-outanimation="fadeOutDownBig">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="The personal website,blog of yuri yu: programmer, web developer.
">
    <meta name="keywords" content="MEGATONTECH, web dev, web developer, YURI , YU,techme">
    <meta name="author" content="Yuri yu">
    <meta name="google-site-verification" content="J1I2enqCVWPWxLX82JE84giuntMY1SztQxGovPSBLc4">
    <title>Yuri yu- Home</title>
    <!-- FAV and TOUCH ICONS -->
    <link rel="shortcut icon" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
    <script src="/js/modernizr.custom.js"></script>
    <!-- STYLES -->
    <link rel="stylesheet" media="print" href="/css/print.css">
    <link rel="stylesheet" href="/css/normalize.css">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/js/nprogress/nprogress.css">
    <link rel="stylesheet" href="/css/animate.css">
    <link rel="stylesheet" href="/css/fonts/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/fonts/fontello/css/fontello.css">
    <link rel="stylesheet" href="/css/jquery.fancybox-1.3.4.css">
    <link rel="stylesheet" href="/js/google-code-prettify/prettify.css">
    <link rel="stylesheet" href="/css/uniform.default.css">
    <link rel="stylesheet" href="/css/flexslider.css">
    <link rel="stylesheet" href="/js/mediaelement/mediaelementplayer.css">
    <link rel="stylesheet" href="/css/tooltipster.css">
    <link rel="stylesheet" href="/css/rr_light.css">
    <link rel="stylesheet" href="/js/tipuesearch/tipuesearch.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/personal.css">
    <link rel="stylesheet" href="/css/fonts.googleapis.com.css">
    <!--[if lte IE 9]>
    <script src="/js/html5shiv.js"></script>
    <script src="/js/respond.min.js"></script>
    <script src="/js/selectivizr-min.js"></script>
    <![endif]-->
</head>

<body>
    <!-- CONTAINER -->
    <div class="container" id="container">
        <!-- HEADER -->
        <header class="header">
            <h1>yuri yu</h1>
            <p>geek, programmer, web developer, acfuner</p>
            <!-- NAV MENU -->
            <ul class="vs-nav">
                <li><a href="/"><i title="go to home" class="icon-home-1 tooltip" data-tooltip-pos="bottom"></i></a></li>
                <li><a><i title="search" class="search-link fa fa-search tooltip" data-tooltip-pos="right"></i></a></li>
            </ul>
            <!-- NAV MENU -->
            <!-- SEARCH -->
            <div class="header-search">
                <form role="search" method="get" id="search-form" action="/search">
                    <input type="text" name="q" id="search" placeholder="ENTER KEYWORD" required>
                    <input type="submit" id="search-submit" title="Search" value="→">
                </form>
            </div>
            <!-- SEARCH -->
        </header>
        <!-- HEADER -->
        <!-- WRAPPER -->
        <div class="wrapper">
            <!-- .blog-single -->
            <div class="readable-content blog-single">
                <!-- .hentry -->
                <article class="post type-post format-standard hentry">
                    <!-- .entry-header -->
                    <header class="entry-header">
                        <h1 class="entry-title">Restful 软件架构风格</h1>
                    </header>
                    <!-- .entry-header -->
                    <!-- .entry-meta -->
                    <div class="entry-meta">
                        <span class="posted-in">
                        </span>
                        <span class="posted-on">
                            on
                            <a rel="bookmark"><time class="entry-date">jun 24, 2016</time></a>
                        </span>

                        <span class="posted-by">
                            by
                            <a href="/blog" class="url fn n" title="View all posts by this author" rel="author">Yuri yu</a>
                        </span>
                    </div>
                    <!-- .entry-meta -->
                    <!-- .featured-image -->
                    <div class="featured-image">
                        <img src="/img/posts/Restful.jpg" alt="A screenshot of the Restful" title="EDI">
                    </div>
                    <!-- .featured-image -->
                    <!-- .entry-content -->
                    <div class="entry-content">
                        <p>本文内容很简单，只阐述下面几个问题——一切美好的东西都应该是简单的</p>
                         
                        <div id="LeftContent">
                            <div class="navpage" xmlns="http://www.w3.org/1999/xhtml">
                                <div>
                                    <div class="MagazineStyle">
                                        <div>
                                            <div>
                                                <div class="FeatureTitle">
                                                    <h2>
                                                        <span id="mttgt1" class="sentence" data-guid="" data-approved="" xml:space="preserve">数据点</span>
                                                    </h2>
                                                    <h1>
                                                        <span id="mttgt2" class="sentence" data-guid="" data-approved="" xml:space="preserve">领域驱动设计的编码： 数据聚焦型开发的技巧</span>
                                                    </h1>
                                                    <p>
                                                        <strong>
                                                            <a href="https://msdn.microsoft.com/zh-cn/magazine/ee532098.aspx?sdmr=julielerman&amp;sdmi=authors">
                                                                <span id="mttgt3" class="sentence" data-guid="" data-approved="" xml:space="preserve">Julie Lerman</span>
                                                            </a>
                                                        </strong>
                                                    </p>
                                                    <p>
                                                        <strong>
                                                            <a href="http://archive.msdn.microsoft.com/mag201308datapoints">
                                                                <span id="mttgt4" class="sentence" data-guid="" data-approved="" xml:space="preserve">下载代码示例</span>
                                                            </a>
                                                        </strong>
                                                    </p>
                                                </div>
                                                <p>
                                                    <img alt="Julie Lerman" src="https://i-msdn.sec.s-msft.com/dn342868.julie_lerman_headshot.jpg" style="float:left;margin:0 1em .5em 0;">
                                                    <span id="mttgt5" class="sentence" data-guid="" data-approved="" xml:space="preserve">今年，Eric Evans 具有开创性的软件设计图书“Domain-Driven Design: Tackling Complexity in the Heart of Software”（领域驱动设计：软件核心复杂性应对之道）（Addison-Wesley Professional，2003 年，<a href="http://amzn.to/ffL1k" xmlns="http://www.w3.org/1999/xhtml">amzn.to/ffL1k</a>）迎来了其出版十周年的纪念日。</span>
                                                    <span id="mttgt6" class="sentence" data-guid="" data-approved="" xml:space="preserve">Evans 在本书中分享了其指导大型企业完成构建软件的过程的多年经验。</span>
                                                    <span id="mttgt7" class="sentence" data-guid="" data-approved="" xml:space="preserve">他随后花了更长时间考虑如何概括帮助这些项目获得成功的模式 - 与客户交互、分析要解决的企业问题、组建团队和设计软件的架构。</span>
                                                    <span id="mttgt8" class="sentence" data-guid="" data-approved="" xml:space="preserve">这些模式的焦点是企业的领域，它们共同组成领域驱动设计 (DDD)。</span>
                                                    <span id="mttgt9" class="sentence" data-guid="" data-approved="" xml:space="preserve">利用 DDD，您可以为有问题的领域建模。</span>
                                                    <span id="mttgt10" class="sentence" data-guid="" data-approved="" xml:space="preserve">这些模式是通过抽象化您对领域的知识产生的。</span>
                                                    <span id="mttgt11" class="sentence" data-guid="" data-approved="" xml:space="preserve">即使在今天，重读 Martin Fowler 的前言和 Evans 的序言仍能获得对 DDD 本质的丰富概览。</span>
                                                </p>
                                                <p>
                                                    <span id="mttgt12" class="sentence" data-guid="" data-approved="" xml:space="preserve">在本专栏以及接下来的两个专栏中，我将分享一些指导原则，在我着手让我的代码从某些 DDD 技术模式获益时，这些原则帮助我那注重数据的 Entity Framework 大脑保持清晰的思维。</span>
                                                </p>
                                                <h2>
                                                    <span id="mttgt13" class="sentence" data-guid="" data-approved="" xml:space="preserve">我为什么关注 DDD？</span>
                                                </h2>
                                                <p>
                                                    <span id="mttgt14" class="sentence" data-guid="" data-approved="" xml:space="preserve">我对 DDD 的介绍摘自发布于 <a href="http://infoq.com/" xmlns="http://www.w3.org/1999/xhtml">InfoQ.com</a> 上的对 Jimmy Nilsson 的简短视频访谈。Jimmy Nilsson 是 .NET 社区（以及其他地方）一位受人尊敬的架构师，他在访谈中谈到了 LINQ to SQL 和 Entity Framework (<a href="http://bit.ly/11DdZue" xmlns="http://www.w3.org/1999/xhtml">bit.ly/11DdZue</a>)。</span>
                                                    <span id="mttgt15" class="sentence" data-guid="" data-approved="" xml:space="preserve">在访谈的最后，Nilsson 被要求列举他最喜欢的技术书籍。</span>
                                                    <span id="mttgt16" class="sentence" data-guid="" data-approved="" xml:space="preserve">他回答道： “我最喜欢的计算机书籍是 Eric Evans 编著的“Domain-Driven Design”（领域驱动设计）。我觉得它就像诗一样美妙。</span>
                                                    <span id="mttgt17" class="sentence" data-guid="" data-approved="" xml:space="preserve">它不仅内容精彩，还有诗一般的韵味，让人百读不厌。”诗一般的美妙！</span>
                                                    <span id="mttgt18" class="sentence" data-guid="" data-approved="" xml:space="preserve">当时，我正在写我的第一本技术书籍“Programming Entity Framework”（实体框架编程）（O’Reilly Media，2009 年），这一描述引发了我的兴趣。</span>
                                                    <span id="mttgt19" class="sentence" data-guid="" data-approved="" xml:space="preserve">因此，我去读了一点 Evans 的书，想看看到底写得如何。</span>
                                                    <span id="mttgt20" class="sentence" data-guid="" data-approved="" xml:space="preserve">Evans 是一个行文优美而流畅的作者，</span>
                                                    <span id="mttgt21" class="sentence" data-guid="" data-approved="" xml:space="preserve">再加上他在软件开发领域具有敏锐而自然的见解，读者在阅读本书时体验到了充分的乐趣。</span>
                                                    <span id="mttgt22" class="sentence" data-guid="" data-approved="" xml:space="preserve">不过，使我感到震撼的还有我读到的内容。</span>
                                                    <span id="mttgt23" class="sentence" data-guid="" data-approved="" xml:space="preserve">Evans 不仅文笔极佳，而且书中的内容也非常吸引我。</span>
                                                    <span id="mttgt24" class="sentence" data-guid="" data-approved="" xml:space="preserve">他提到与客户建立关系并真正了解其业务和业务问题（与有问题的软件有关），而不只是苦苦编写代码。</span>
                                                    <span id="mttgt25" class="sentence" data-guid="" data-approved="" xml:space="preserve">在我 25 年的软件开发生涯中，这个观点起到了举足轻重的作用。</span>
                                                    <span id="mttgt26" class="sentence" data-guid="" data-approved="" xml:space="preserve">我想要实现更多。</span>
                                                </p>
                                                <p>
                                                    <span id="mttgt27" class="sentence" data-guid="" data-approved="" xml:space="preserve">我在 DDD 领域的边缘又徘徊了很多年，然后开始了解更多内容 - 我在一次会议上见到了 Evans，随后参加了他为期四天的浸入式研讨会。</span>
                                                    <span id="mttgt28" class="sentence" data-guid="" data-approved="" xml:space="preserve">虽然我远远不是 DDD 方面的专家，但我发现在试图将自己的软件创建过程向更有条理且更易于管理的结构转变时，可立即使用“界定的上下文”模式。</span>
                                                    <span id="mttgt29" class="sentence" data-guid="" data-approved="" xml:space="preserve">您可以阅读我的 2013 年 1 月专栏中的主题“使用 DDD 界定的上下文收缩 EF 模型”(<a href="https://msdn.microsoft.com/magazine/jj883952" xmlns="http://www.w3.org/1999/xhtml">msdn.microsoft.com/magazine/jj883952</a>)。</span>
                                                </p>
                                                <p>
                                                    <span id="mttgt30" class="sentence" data-guid="" data-approved="" xml:space="preserve">从那时起，我对 DDD 的研究又深入了一步。</span>
                                                    <span id="mttgt31" class="sentence" data-guid="" data-approved="" xml:space="preserve">我对 DDD 感到深深着迷，并从中获得了很多灵感，但我为从数据驱动的角度理解一些可推动成功的技术模式而纠结。</span>
                                                    <span id="mttgt32" class="sentence" data-guid="" data-approved="" xml:space="preserve">似乎有很多开发人员也遇到了相同的问题，因此我想分享在 Evans 和很多其他 DDD 实践者和教师（包括 Paul Rayner、Vaughn Vernon、Greg Young、Cesar de la Torre 和 Yves Reynhout）的慷慨帮助和关心之下吸取的经验教训。</span>
                                                </p>
                                                <h2>
                                                    <span id="mttgt33" class="sentence" data-guid="" data-approved="" xml:space="preserve">在为域建模时忘记持久性</span>
                                                </h2>
                                                <p>
                                                    <span id="mttgt34" class="sentence" data-guid="" data-approved="" xml:space="preserve">为域建模就是重点关注企业的任务。</span>
                                                    <span id="mttgt35" class="sentence" data-guid="" data-approved="" xml:space="preserve">在设计类型及其属性和行为时，我非常倾向于考虑关系如何在数据库中发挥作用以及我选择的对象关系映射 (ORM) 框架（即 Entity Framework）将如何处理我构建的属性、关系和继承层次结构。</span>
                                                    <span id="mttgt36" class="sentence" data-guid="" data-approved="" xml:space="preserve">除非您为从事数据存储和检索业务的公司（像 Dropbox 一样）构建软件，否则数据持久性仅在您的应用程序中起到支持作用。</span>
                                                    <span id="mttgt37" class="sentence" data-guid="" data-approved="" xml:space="preserve">这非常像调用天气源的 API 以便向用户显示当前温度，</span>
                                                    <span id="mttgt38" class="sentence" data-guid="" data-approved="" xml:space="preserve">或者，从您的应用程序向外部服务发送数据（可能是 Meetup.com 上的注册信息）。</span>
                                                    <span id="mttgt39" class="sentence" data-guid="" data-approved="" xml:space="preserve">当然，您的数据可能更加复杂，但利用 DDD 的上下文界定方法，通过关注行为和在构建类型时遵循 DDD 指导，持久性可能比您在今天构建的系统简单得多。</span>
                                                </p>
                                                <p>
                                                    <span id="mttgt40" class="sentence" data-guid="" data-approved="" xml:space="preserve">如果您已仔细研究 ORM（例如，了解如何使用 Entity Framework Fluent API 配置数据库映射），则应能根据需要实现持久性。</span>
                                                    <span id="mttgt41" class="sentence" data-guid="" data-approved="" xml:space="preserve">最糟糕的情况是，您可能需要对您的类做一些调整。</span>
                                                    <span id="mttgt42" class="sentence" data-guid="" data-approved="" xml:space="preserve">在极端情况下（例如，使用旧数据库时），您甚至可以添加专为数据库映射设计的持久性模型，然后使用 AutoMapper 等工具解析域模型和持久性模型之间的映射。</span>
                                                </p>
                                                <p>
                                                    <span id="mttgt43" class="sentence" data-guid="" data-approved="" xml:space="preserve">但是，这些关注点与您的软件用于解决的业务问题无关，因此持久性不应影响域设计。</span>
                                                    <span id="mttgt44" class="sentence" data-guid="" data-approved="" xml:space="preserve">这对我来说是一个难题，因为我在设计实体时会忍不住考虑 EF 将如何推断其数据库映射。</span>
                                                    <span id="mttgt45" class="sentence" data-guid="" data-approved="" xml:space="preserve">因此，我试图解决这件烦心事。</span>
                                                </p>
                                                <h2>
                                                    <span id="mttgt46" class="sentence" data-guid="" data-approved="" xml:space="preserve">私有 Setter 和公共方法</span>
                                                </h2>
                                                <p>
                                                    <span id="mttgt47" class="sentence" data-guid="" data-approved="" xml:space="preserve">另一个经验法则是将属性 setter 设为私有。</span>
                                                    <span id="mttgt48" class="sentence" data-guid="" data-approved="" xml:space="preserve">您应使用修改属性的方法控制与 DDD 对象及其相关数据的交互，而不是允许通过调用代码来随机设置各种属性。</span>
                                                    <span id="mttgt49" class="sentence" data-guid="" data-approved="" xml:space="preserve">不，我不是指 SetFirstName 和 SetLastName 之类的方法。</span>
                                                    <span id="mttgt50" class="sentence" data-guid="" data-approved="" xml:space="preserve">例如，您在创建新客户前需要考虑一些规则，而不是实例化新的 Customer 类型并设置其各个属性。</span>
                                                    <span id="mttgt51" class="sentence" data-guid="" data-approved="" xml:space="preserve">您可以将这些规则内置于 Customer 的构造函数中，使用 Factory Pattern 方法，甚至在 Customer 类型中包含 Create 方法。</span>
                                                    <span id="mttgt52" class="sentence" data-guid="" data-approved="" xml:space="preserve">
                                                    <strong xmlns="http://www.w3.org/1999/xhtml">图 1</strong> 显示按照聚合根（即对象图的“父级”，也称为 DDD 中的“根实体”）的 DDD 模式定义的 Customer 类型。</span>
                                                    <span id="mttgt53" class="sentence" data-guid="" data-approved="" xml:space="preserve">客户属性具有私有 setter，以便仅 Customer 类的其他成员能够直接影响这些属性。</span>
                                                    <span id="mttgt54" class="sentence" data-guid="" data-approved="" xml:space="preserve">该类公开了构造函数以控制其实例化方式，并将无参数构造函数（Entity Framework 需要）隐藏为内部构造函数。</span>
                                                </p>
                                                <div>
                                                    <p>
                                                        <strong>
                                                            <span id="mttgt55" class="sentence" data-guid="" data-approved="" xml:space="preserve">图 1 充当聚合根的类型的属性和方法</span>
                                                        </strong>
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="code-snippet-1" class="codeSnippetContainer" xmlns="">
                                            <div class="codeSnippetContainerTabs">
                                                <div class="codeSnippetContainerTabSingle" dir="ltr"><a>C#</a></div>
                                            </div>
                                            <div class="codeSnippetContainerCodeContainer">
                                                <div class="codeSnippetToolBar">
                                                    <div class="codeSnippetToolBarText">
                                                        <a name="CodeSnippetCopyLink" style="display: none;" title="复制到剪贴板。" href="javascript:if (window.epx.codeSnippet)window.epx.codeSnippet.copyCode('CodeSnippetContainerCode_d056f6c6-88b1-4af1-86bd-5c3cb91ff963');" ms.cmptyp="CodeSnippet">复制</a>
                                                    </div>
                                                </div>
                                                <div id="CodeSnippetContainerCode_d056f6c6-88b1-4af1-86bd-5c3cb91ff963" class="codeSnippetContainerCode" dir="ltr">
                                                    <div style="color:Black;">
                                                        <pre><span style="color:Blue;">public</span>&nbsp;<span style="color:Blue;">class</span>&nbsp;Customer&nbsp;:&nbsp;Contact
{
&nbsp;&nbsp;<span style="color:Blue;">public</span>&nbsp;Customer(<span style="color:Blue;">string</span>&nbsp;firstName,<span style="color:Blue;">string</span>&nbsp;lastName,&nbsp;<span style="color:Blue;">string</span>&nbsp;email)
&nbsp; { ...&nbsp;}
&nbsp;&nbsp;<span style="color:Blue;">internal</span>&nbsp;Customer(){ ...&nbsp;}
&nbsp;&nbsp;<span style="color:Blue;">public</span>&nbsp;<span style="color:Blue;">void</span>&nbsp;CopyBillingAddressToShippingAddress(){ ...&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;<span style="color:Blue;">public</span>&nbsp;<span style="color:Blue;">void</span>&nbsp;CreateNewShippingAddress(
&nbsp;&nbsp; <span style="color:Blue;">string</span>&nbsp;street,&nbsp;<span style="color:Blue;">string</span>&nbsp;city, <span style="color:Blue;">string</span>&nbsp;zip) { ...&nbsp;}
&nbsp;&nbsp;<span style="color:Blue;">public</span>&nbsp;<span style="color:Blue;">void</span>&nbsp;CreateBillingInformation(
&nbsp;&nbsp; <span style="color:Blue;">string</span>&nbsp;street,&nbsp;<span style="color:Blue;">string</span>&nbsp;city, <span style="color:Blue;">string</span>&nbsp;zip,
&nbsp;&nbsp; <span style="color:Blue;">string</span>&nbsp;creditcardNumber,&nbsp;<span style="color:Blue;">string</span>&nbsp;bankName){ ...&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;<span style="color:Blue;">public</span>&nbsp;<span style="color:Blue;">void</span>&nbsp;SetCustomerContactDetails(
&nbsp;&nbsp; <span style="color:Blue;">string</span>&nbsp;email,&nbsp;<span style="color:Blue;">string</span>&nbsp;phone, <span style="color:Blue;">string</span>&nbsp;companyName){ ...&nbsp;}
&nbsp;&nbsp;<span style="color:Blue;">public</span>&nbsp;<span style="color:Blue;">string</span>&nbsp;SalesPersonId&nbsp;{&nbsp;<span style="color:Blue;">get</span>;&nbsp;<span style="color:Blue;">private</span>&nbsp;<span style="color:Blue;">set</span>;&nbsp;}
&nbsp;&nbsp;<span style="color:Blue;">public</span>&nbsp;CustomerStatus&nbsp;Status{<span style="color:Blue;">get</span>;<span style="color:Blue;">private</span>&nbsp;<span style="color:Blue;">set</span>;}
&nbsp;&nbsp;<span style="color:Blue;">public</span>&nbsp;Address&nbsp;ShippingAddress&nbsp;{&nbsp;<span style="color:Blue;">get</span>;&nbsp;<span style="color:Blue;">private</span>&nbsp;<span style="color:Blue;">set</span>;&nbsp;}
&nbsp;&nbsp;<span style="color:Blue;">public</span>&nbsp;Address&nbsp;BillingAddress&nbsp;{&nbsp;<span style="color:Blue;">get</span>;<span style="color:Blue;">private</span>&nbsp;<span style="color:Blue;">set</span>;&nbsp;}
&nbsp;&nbsp;<span style="color:Blue;">public</span>&nbsp;CustomerCreditCard&nbsp;CreditCard&nbsp;{&nbsp;<span style="color:Blue;">get</span>;&nbsp;<span style="color:Blue;">private</span>&nbsp;<span style="color:Blue;">set</span>;&nbsp;}
}
</pre>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                        <div><div><p><span id="mttgt57" class="sentence" data-guid="" data-approved="" xml:space="preserve">Customer 类型通过以下方式控制和保护聚合中的其他实体（一些地址和信用卡类型）：公开将用于创建和操作这些对象的特定方法（如 CopyBillingAddressToShippingAddress）。 </span><span id="mttgt58" class="sentence" data-guid="" data-approved="" xml:space="preserve">聚合根必须确保通过在这些方法中实现的域逻辑和行为应用定义聚合中的每个实体的规则。 </span><span id="mttgt59" class="sentence" data-guid="" data-approved="" xml:space="preserve">最重要的一点是，聚合根负责确保聚合中的固定条件逻辑和一致性。 </span><span id="mttgt60" class="sentence" data-guid="" data-approved="" xml:space="preserve">我将在下一个专栏中详细讨论固定条件，同时，我建议您阅读 Jimmy Bogard 的博客文章“Strengthening Your Domain: Aggregate Construction”（增强您的域：聚合结构）（网址为 <a href="http://bit.ly/ewNZ52" xmlns="http://www.w3.org/1999/xhtml">bit.ly/ewNZ52</a>），该文很好地解释了聚合中的固定条件。 </span></p><p><span id="mttgt61" class="sentence" data-guid="" data-approved="" xml:space="preserve">最后，Customer 公开的内容是行为而不是属性： CopyBillingAddressToShippingAddress、CreateNewShipping&shy;Address、CreateBillingInformation 和 SetCustomerContactDetails。 </span></p><p><span id="mttgt62" class="sentence" data-guid="" data-approved="" xml:space="preserve">请注意，从中派生 Customer 的 Contact 类型位于名为“Common”的另一个程序集中，因为其他类可能需要该类型。 </span><span id="mttgt63" class="sentence" data-guid="" data-approved="" xml:space="preserve">我需要隐藏 Contact 的属性，但它们不能是私有属性，否则 Customer 将无法访问它们。 </span><span id="mttgt64" class="sentence" data-guid="" data-approved="" xml:space="preserve">相反，应将其范围设为“受保护”： </span></p></div></div>
                                        <div id="code-snippet-2" class="codeSnippetContainer" xmlns="">
                                            <div class="codeSnippetContainerTabs">
                                                <div class="codeSnippetContainerTabSingle" dir="ltr"><a>C#</a></div>
                                            </div>
                                            <div class="codeSnippetContainerCodeContainer">
                                                <div class="codeSnippetToolBar">
                                                    <div class="codeSnippetToolBarText">
                                                        <a name="CodeSnippetCopyLink" style="display: none;" title="复制到剪贴板。" href="javascript:if (window.epx.codeSnippet)window.epx.codeSnippet.copyCode('CodeSnippetContainerCode_dbfe9f40-98e8-4044-ba25-f17636214c3f');" ms.cmptyp="CodeSnippet">复制</a>
                                                    </div>
                                                </div>
                                                <div id="CodeSnippetContainerCode_dbfe9f40-98e8-4044-ba25-f17636214c3f" class="codeSnippetContainerCode" dir="ltr">
                                                    <div style="color:Black;">
                                                        <pre><span style="color:Blue;">public</span>&nbsp;<span style="color:Blue;">class</span>&nbsp;Contact:&nbsp;Identity
{
&nbsp;&nbsp;<span style="color:Blue;">public</span>&nbsp;<span style="color:Blue;">string</span>&nbsp;CompanyName&nbsp;{&nbsp;<span style="color:Blue;">get</span>;&nbsp;<span style="color:Blue;">protected</span>&nbsp;<span style="color:Blue;">set</span>;&nbsp;}
&nbsp;&nbsp;<span style="color:Blue;">public</span>&nbsp;<span style="color:Blue;">string</span>&nbsp;EmailAddress&nbsp;{&nbsp;<span style="color:Blue;">get</span>;&nbsp;<span style="color:Blue;">protected</span>&nbsp;<span style="color:Blue;">set</span>;&nbsp;}
&nbsp;&nbsp;<span style="color:Blue;">public</span>&nbsp;<span style="color:Blue;">string</span>&nbsp;Phone&nbsp;{&nbsp;<span style="color:Blue;">get</span>;&nbsp;<span style="color:Blue;">protected</span>&nbsp;<span style="color:Blue;">set</span>;&nbsp;}
}
</pre>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <div>
                                                <p><span id="mttgt66" class="sentence" data-guid="" data-approved="" xml:space="preserve">关于标识的附注： Customer 和 Contact 可能看起来像 DDD 值对象，因为它们没有键值。</span><span id="mttgt67" class="sentence" data-guid="" data-approved="" xml:space="preserve">但在我的解决方案中，键值由从中派生 Contact 的 Identity 类提供。</span><span id="mttgt68" class="sentence" data-guid="" data-approved="" xml:space="preserve">这些类型都不是固定不变的，因此任何情况下都不能将它们视为值对象。</span></p><p><span id="mttgt69" class="sentence" data-guid="" data-approved="" xml:space="preserve">由于 Customer 继承自 Contact，因此 Customer 能够访问和设置这些受保护的属性，如以下 SetCustomerContactDetails 方法中所示：</span></p><p><span id="mttgt70" class="sentence" data-guid="" data-approved="" xml:space="preserve">public&nbsp;void&nbsp;SetCustomerContactDetails (string email, string phone, string companyName)</span></p><p><span id="mttgt71" class="sentence" data-guid="" data-approved="" xml:space="preserve">{</span></p><p><span id="mttgt72" class="sentence" data-guid="" data-approved="" xml:space="preserve">&nbsp;&nbsp;EmailAddress = email;</span></p><p><span id="mttgt73" class="sentence" data-guid="" data-approved="" xml:space="preserve">&nbsp;&nbsp;Phone = phone;</span></p><p><span id="mttgt74" class="sentence" data-guid="" data-approved="" xml:space="preserve">&nbsp;&nbsp;CompanyName = companyName;</span></p><p><span id="mttgt75" class="sentence" data-guid="" data-approved="" xml:space="preserve">}</span></p><h2><span id="mttgt76" class="sentence" data-guid="" data-approved="" xml:space="preserve">有时您只需 CRUD 就够了</span></h2><p><span id="mttgt77" class="sentence" data-guid="" data-approved="" xml:space="preserve">在您的应用程序中，并非所有内容都需要使用 DDD 来创建。</span><span id="mttgt78" class="sentence" data-guid="" data-approved="" xml:space="preserve">DDD 用来帮助处理复杂的行为。</span><span id="mttgt79" class="sentence" data-guid="" data-approved="" xml:space="preserve">如果您只需执行一些粗略而随意的编辑或查询，则一个简单类（或一组类）就足够了。此简单类的定义方式与您平时使用 EF Code First（使用属性和关系）时一样，它还与插入、更新和删除方法（通过存储库或只是 DbContext）结合使用。</span><span id="mttgt80" class="sentence" data-guid="" data-approved="" xml:space="preserve">因此，若要完成创建订单及其明细项目之类的操作，您可能需要 DDD 来帮助执行特殊的业务规则和行为。</span><span id="mttgt81" class="sentence" data-guid="" data-approved="" xml:space="preserve">例如，下订单的是否是此金星级客户？</span><span id="mttgt82" class="sentence" data-guid="" data-approved="" xml:space="preserve">在这种情况下，您需要获取一些客户详细信息来确定答案是否为“是”，如果是这样，则对要添加到订单的每个项目应用 10% 的折扣。</span><span id="mttgt83" class="sentence" data-guid="" data-approved="" xml:space="preserve">用户是否已提供其信用卡信息？</span><span id="mttgt84" class="sentence" data-guid="" data-approved="" xml:space="preserve">随后，您可能需要调用验证服务来确保该信用卡有效。</span></p><p><span id="mttgt85" class="sentence" data-guid="" data-approved="" xml:space="preserve">DDD 的关键在于将域逻辑作为方法包含在域的实体类中，并在无状态业务对象中利用 OOP 而不是实现“事务脚本”，这是典型演示件 Code First 类的外观。&nbsp;</span></p><p><span id="mttgt86" class="sentence" data-guid="" data-approved="" xml:space="preserve">不过，有时您执行的所有操作都是非常标准的，例如创建联系人记录 （姓名、地址、推荐人等）并保存该信息。这就是所谓的创建、阅读、更新和删除 (CRUD)。</span><span id="mttgt87" class="sentence" data-guid="" data-approved="" xml:space="preserve">您不需要创建聚合、根和行为即可满足该要求。</span></p><p><span id="mttgt88" class="sentence" data-guid="" data-approved="" xml:space="preserve">您的应用程序很可能包含复杂行为和简单 CRUD 的组合。</span><span id="mttgt89" class="sentence" data-guid="" data-approved="" xml:space="preserve">花时间来阐明行为吧，不要把时间、精力和金钱浪费在过度设计事实上非常简单的应用程序部件的架构上。</span><span id="mttgt90" class="sentence" data-guid="" data-approved="" xml:space="preserve">在这些情况下，标识不同子系统或界定的上下文之间的边界很重要。</span><span id="mttgt91" class="sentence" data-guid="" data-approved="" xml:space="preserve">界定的上下文可能在很大程度上是由数据驱动的（即 CRUD），而另一方面，以核心领域界定的关键上下文应按 DDD 方法进行设计。</span></p><h2><span id="mttgt92" class="sentence" data-guid="" data-approved="" xml:space="preserve">共享数据在复杂系统中可能是个大麻烦</span></h2><p><span id="mttgt93" class="sentence" data-guid="" data-approved="" xml:space="preserve">我遇到了另一个问题，当其他人满怀好意地试图进一步说明时，我抱怨不已，对跨子系统共享类型和数据充满担心。</span><span id="mttgt94" class="sentence" data-guid="" data-approved="" xml:space="preserve">很明显，我不可能鱼与熊掌兼得，因此我必须重新考虑我的假设：我绝对必须积极地跨系统共享类型，并让所有这些类型与同一数据库中的同一表进行交互。</span></p><p><span id="mttgt95" class="sentence" data-guid="" data-approved="" xml:space="preserve">我正在学习实际考虑需在何处共享数据，然后迎接挑战。</span><span id="mttgt96" class="sentence" data-guid="" data-approved="" xml:space="preserve">有些事情可能不值得尝试，例如，从不同的上下文映射到单个表，甚至单个数据库。</span><span id="mttgt97" class="sentence" data-guid="" data-approved="" xml:space="preserve">最常见的示例是共享尝试满足系统中所有人的需求的 Contact。</span><span id="mttgt98" class="sentence" data-guid="" data-approved="" xml:space="preserve">您如何为大量系统中可能需要的 Contact 类型协调和利用源代码管理？</span><span id="mttgt99" class="sentence" data-guid="" data-approved="" xml:space="preserve">如果有系统需要修改该 Contact 类型的定义，该怎么办？</span><span id="mttgt100" class="sentence" data-guid="" data-approved="" xml:space="preserve">对于 ORM，您如何将在多个系统中使用的 Contact 映射到单个数据库中的单个表？</span></p><p><span id="mttgt101" class="sentence" data-guid="" data-approved="" xml:space="preserve">通过说明您并不总是需要指向单个数据库中的同一个人员表，DDD 可指导您避免共享域模型和数据。</span></p><p><span id="mttgt102" class="sentence" data-guid="" data-approved="" xml:space="preserve">我反对此行为的最大理由源于这 25 年来我对重用（重用代码和重用数据）的好处的关注。</span><span id="mttgt103" class="sentence" data-guid="" data-approved="" xml:space="preserve">因此，我对以下观点既感到费解又很有兴趣： 复制数据并不是犯罪行为。</span><span id="mttgt104" class="sentence" data-guid="" data-approved="" xml:space="preserve">当然，并非所有数据都适合此新模式（对我而言）。</span><span id="mttgt105" class="sentence" data-guid="" data-approved="" xml:space="preserve">不过，对于轻量型内容（如人员姓名），情况又如何呢？</span><span id="mttgt106" class="sentence" data-guid="" data-approved="" xml:space="preserve">如果您将人员的名字和姓氏复制到多个表中，甚至复制到专用于软件解决方案的各个子系统的多个数据库中，会怎么样呢？</span><span id="mttgt107" class="sentence" data-guid="" data-approved="" xml:space="preserve">从长远来看，通过消除共享数据的复杂性，可大大简化构建系统这一工作。</span><span id="mttgt108" class="sentence" data-guid="" data-approved="" xml:space="preserve">在任何情况下，您必须始终最大程度地减少在不同的界定上下文中复制数据和属性的工作。</span><span id="mttgt109" class="sentence" data-guid="" data-approved="" xml:space="preserve">有时，您只需要客户的 ID 和状态便能计算 Pricing 界定的上下文中的折扣。</span><span id="mttgt110" class="sentence" data-guid="" data-approved="" xml:space="preserve">可能只在 Contact Management 界定的上下文中需要此客户的名字和姓氏。</span></p><p><span id="mttgt111" class="sentence" data-guid="" data-approved="" xml:space="preserve">但是，仍然有如此多的信息需要在系统之间进行共享。</span><span id="mttgt112" class="sentence" data-guid="" data-approved="" xml:space="preserve">您可以利用 DDD 称之为“反损坏层”（可以像服务或消息队列一样简单）的工具来确保当有人在一个系统中创建了新联系人时，您可以确定该人员在其他位置是否已存在，或确保人员及常用标识键已在其他子系统中创建。</span></p><h2><span id="mttgt113" class="sentence" data-guid="" data-approved="" xml:space="preserve">下个月前要考虑的大量问题</span></h2><p><span id="mttgt114" class="sentence" data-guid="" data-approved="" xml:space="preserve">当我学习和理解领域驱动型设计的技术方面、努力协调旧习惯和新思想以及无数次觉得茅塞顿开时，我在这里讨论的心得真正起到了拨开云雾见青天的效果。</span><span id="mttgt115" class="sentence" data-guid="" data-approved="" xml:space="preserve">有时，这只是一种观点，我在这里表达这些心得的方式反映了帮助我更清晰地了解事物的观点。</span></p><p><span id="mttgt116" class="sentence" data-guid="" data-approved="" xml:space="preserve">我将在下一个专栏中分享我的得意时刻，并将在其中讨论您可能听到过的表现优劣的用词： “贫乏的域模型”及其 DDD 同类“丰富的域模型”。我还将讨论不定向关系，并讨论在您使用 Entity Framework 的情况下，在需要添加数据持久性时要考虑的内容。</span><span id="mttgt117" class="sentence" data-guid="" data-approved="" xml:space="preserve">我还将探讨更多的 DDD 主题，这些主题为我缩短您自己的学习曲线的工作带来了大量困难。</span></p><p><span id="mttgt118" class="sentence" data-guid="" data-approved="" xml:space="preserve">到那时，为何不更详细地观察您自己的类并了解如何更倾向于做一个控制狂，隐藏这些属性 setter 并公开更多描述性和显式方法。</span><span id="mttgt119" class="sentence" data-guid="" data-approved="" xml:space="preserve">还要记住： 不允许使用“SetLastName”方法。</span><span id="mttgt120" class="sentence" data-guid="" data-approved="" xml:space="preserve">开个玩笑！</span></p><div class="solidLine"></div><div>
                                                    <div>
                                                        <div>
                                                            <div>
                                                                <p>
                                                                    <span id="mttgt121" class="sentence" data-guid="" data-approved="" xml:space="preserve"><strong xmlns="http://www.w3.org/1999/xhtml">Julie Lerman</strong>
<em xmlns="http://www.w3.org/1999/xhtml">是 Microsoft MVP、.NET 导师和顾问，住在佛蒙特州的山区。 您可以在全球的用户组和会议中看到她对数据访问和其他 Microsoft .NET 主题的演示。 她是“Programming Entity Framework”（实体框架编程）(2010) 以及“代码优先”版 (2011) 和 DbContext 版 (2012)（均出自 O’Reilly Media）的作者，博客网址为 <a href="http://thedatafarm.com/blog">thedatafarm.com/blog</a>。 通过她的 Twitter（网址为 <a href="http://twitter.com/julielerman">twitter.com/julielerman</a>）关注她，并在 <a href="http://juliel.me/PS-Videos">juliel.me/PS-Videos</a></em> 上观看其 Pluralsight 课程</span>
                                                                </p>
                                                            </div><div><p><span id="mttgt122" class="sentence" data-guid="" data-approved="" xml:space="preserve">衷心感谢以下技术专家对本文的审阅： Cesar de la Torre (Microsoft)</span></p></div>
                                                        </div>
                                                    </div>
                                                </div><p>&nbsp;</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                         
                        <hr />
                        <!-- .related-posts -->
                    </div>
                    <!-- .entry-content -->
                    <!-- .entry-meta -->
                    <footer class="entry-meta">
                        <h3>TAGS</h3>
                        <a href="#" title="">Github</a>
                    </footer>
                    <!-- .entry-meta -->
                </article>
                <!-- .hentry -->
                <!-- .about-author -->
                <aside class="about-author">
                    <h3>WRITTEN BY</h3>
                    <!-- .author-bio -->
                    <div class="author-bio">
                        <!-- .author-img -->
                        <div class="author-img">
                            <a href="/#/about"><img alt="Avatar" src="/img/avatar.png" class="avatar"></a>
                        </div>
                        <!-- .author-img -->
                        <!-- .author-info -->
                        <div class="author-info">
                            <h4 class="author-name">yuri yu</h4>
                            <p>yuri yu is a programmer </p>
                        </div>
                        <!-- .author-info -->
                    </div>
                    <!-- .author-bio -->
                </aside>
                <!-- .about-author -->
                <!-- .nav-single -->
                <nav class="nav-single row">
                    <div class="nav-previous col-sm-6">

                        <h4>PREVIOUS POST</h4>
                        <a href="#" rel="prev"><span class="meta-nav">←</span> There's no more post</a>
                    </div>
                    <div class="nav-next col-sm-6">
                    </div>
                </nav>
                <!-- .nav-single -->
            </div>
            <!-- .blog-single -->
        </div>
        <!-- WRAPPER -->
        <!-- PORTFOLIO SINGLE AJAX CONTENT CONTAINER -->
        <div class="p-overlay"></div>
        <div class="p-overlay"></div>
        <!-- ALERT : used for contact form mail delivery alert -->
        <div class="site-alert animated"></div>
        <!-- SCRIPTS -->
        <script src="/js/jquery-1.10.2.min.js"></script>
        <script src="/js/jquery-migrate-1.2.1.min.js"></script>
        <script src="/js/jquery.address-1.5.min.js"></script>
        <script src="/js/triple.layout.js"></script>
        <script src="/js/smoothscroll.js"></script>
        <script src="/js/nprogress/nprogress.js"></script>
        <script src="/js/fastclick.js"></script>
        <script src="/js/jquery.imagesloaded.min.js"></script>
        <script src="/js/jquery.isotope.min.js"></script>
        <script src="/js/jquery.flexslider-min.js"></script>
        <script src="/js/jquery.fitvids.js"></script>
        <script src="/js/jquery.validate.min.js"></script>
        <script src="/js/jquery.uniform.min.js"></script>
        <script src="/js/jquery.fancybox-1.3.4.pack.js"></script>
        <script src="/js/jquery.tooltipster.min.js"></script>
        <script src="/js/google-code-prettify/prettify.js"></script>
        <script src="/js/twitterFetcher_v10_min.js"></script>
        <script src="/js/mediaelement/mediaelement-and-player.min.js"></script>
        <script src="/js/send-mail.js"></script>
        <script src="/js/classie.js"></script>
        <script src="/js/readmore.min.js"></script>
        <script src="/js/readremaining.jquery.js"></script>
        <script src="/js/personal.js"></script>
        <script src="/js/main.js"></script>
        <script src="/js/blog-post.js"></script>
        <script src="/js/lazyload.js"></script>
        <script>
            $("img").lazyload();
        </script>
    </div>
    <!-- CONTAINER -->
</body>
</html>